"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Builder_1 = require("./Builder");
const emd = require("ecmarkdown");
const Grammar_1 = require("./Grammar");
/*@internal*/
class Algorithm extends Builder_1.default {
    static enter(context) {
        const { node } = context;
        // Need to process emu-grammar elements first so emd doesn't trash the syntax inside emu-grammar nodes
        const grammarNodes = node.querySelectorAll('emu-grammar');
        for (let i = 0; i < grammarNodes.length; i++) {
            let gn = grammarNodes[i];
            context.node = gn;
            Grammar_1.default.enter(context);
            Grammar_1.default.exit(context);
            context.node = node;
        }
        // replace spaces after !/? with &nbsp; to prevent bad line breaking
        const contents = node.innerHTML.replace(/(\s+[\!\?])\s+(\w+\s*\()/g, '$1&nbsp;$2');
        const html = emd.document(contents);
        node.innerHTML = html;
        context.inAlg = true;
    }
    static exit(context) {
        context.inAlg = false;
    }
}
Algorithm.elements = ['EMU-ALG'];
exports.default = Algorithm;
